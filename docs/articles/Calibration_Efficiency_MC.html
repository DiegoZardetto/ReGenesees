<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>On the Efficiency Gain of Calibration Estimators • ReGenesees</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="On the Efficiency Gain of Calibration Estimators">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ReGenesees</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Calibration_Efficiency_MC.html">On the Efficiency Gain of Calibration Estimators</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="Calibration_Efficiency_MC_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>On the Efficiency Gain of Calibration Estimators</h1>
                        <h4 class="author">Diego Zardetto</h4>
            
            <h4 class="date">2020-05-13</h4>
      
      
      <div class="hidden name"><code>Calibration_Efficiency_MC.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>A toy Monte Carlo simulation to show how calibration can increase the precision of survey estimates, while keeping them (nearly) unbiased</p>
</blockquote>
<blockquote>
<p>Also hints at the <strong>‘Model Assisted’</strong> nature of the calibration approach: the underlying linear model exploited by calibration estimators <strong>does not need</strong> to be the actual model describing the relations between interest variables and auxiliary variables</p>
</blockquote>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Set Random Number Generator seed for reproducibility</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">12345</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">######################################################################</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"># Generate an artificial population of N = 5000 units with 4 numeric #</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># interest variables (y1, y2, y3, y4) and 1 auxiliary variable x.    #</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#                                                                    #</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># IMPORTANT REMARK: Interest variables are intentionally generated   #</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#                   so that they covary with x, though typically     #</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#                   *non-linearly* and in very different ways.       #</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">######################################################################</span></span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co"># Population size</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>N &lt;-<span class="st"> </span><span class="dv">5000</span></span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co">## Generate x from Uniform(a = 15, b = 100)</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>x &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(N, <span class="dv">15</span>, <span class="dv">100</span>)</span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">## y1 linear in x</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co"># Generate y1 from linear model y1 ~ a + bx + e</span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="co"># with:</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co">#  a = 10</span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="co">#  b = 2</span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co">#  e from N(mu = 0, sigma = 20)</span></span>
<span id="cb1-25"><a href="#cb1-25"></a>y1 &lt;-<span class="st"> </span><span class="dv">10</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(x), <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb1-26"><a href="#cb1-26"></a></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="co">## y2 quadratic in x</span></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co"># Generate y2 from linear model y2 ~ a + bx^2 + e</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="co"># with:</span></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co">#  a = 10</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="co">#  b = 1/4</span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co">#  e from N(mu = 0, sigma = 200)</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: The data generating model is NOT linear wrt x</span></span>
<span id="cb1-34"><a href="#cb1-34"></a>y2 &lt;-<span class="st"> </span><span class="dv">10</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">*</span><span class="st"> </span>x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(x), <span class="dv">0</span>, <span class="dv">200</span>)</span>
<span id="cb1-35"><a href="#cb1-35"></a></span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="co">## y3 slightly curvilinear in x and heteroskedastic</span></span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="co"># Generate y3 from linear model y3 ~ a + bx^(3/2) + e</span></span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="co"># with:</span></span>
<span id="cb1-39"><a href="#cb1-39"></a><span class="co">#  a = 10</span></span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="co">#  b = 1/4</span></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="co">#  e from N(mu = 0, sigma = x)</span></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: The data generating model is NOT linear wrt x</span></span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: The data generating model is HETEROSKEDASTIC</span></span>
<span id="cb1-44"><a href="#cb1-44"></a>y3 &lt;-<span class="st"> </span><span class="dv">10</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">*</span><span class="st"> </span>x<span class="op">^</span>(<span class="dv">3</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(x), <span class="dv">0</span>, x)</span>
<span id="cb1-45"><a href="#cb1-45"></a></span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="co">## y4 a Bernoulli (dummy) variable with logistic success probability wrt x</span></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="co"># Generate y4 from the logistic model y4 ~ Binomial(1, p(x))</span></span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="co"># with:</span></span>
<span id="cb1-49"><a href="#cb1-49"></a><span class="co">#  p(x) = 1/(1 + exp(-a - bx))</span></span>
<span id="cb1-50"><a href="#cb1-50"></a><span class="co">#  a = -5/2</span></span>
<span id="cb1-51"><a href="#cb1-51"></a><span class="co">#  b = 5/100</span></span>
<span id="cb1-52"><a href="#cb1-52"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: The Median Effective Level x* (such that p(x*) = 1/2) is x* = -a/b = 50</span></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: The data generating model is HIGHLY NONLINEAR wrt x</span></span>
<span id="cb1-54"><a href="#cb1-54"></a>y4 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Binomial">rbinom</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(x), <span class="dv">1</span>, <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="fl">2.5</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.05</span><span class="op">*</span>x)))</span>
<span id="cb1-55"><a href="#cb1-55"></a></span>
<span id="cb1-56"><a href="#cb1-56"></a></span>
<span id="cb1-57"><a href="#cb1-57"></a></span>
<span id="cb1-58"><a href="#cb1-58"></a><span class="co">########################################################</span></span>
<span id="cb1-59"><a href="#cb1-59"></a><span class="co"># Few plots to have a look at the generated variables. #</span></span>
<span id="cb1-60"><a href="#cb1-60"></a><span class="co">########################################################</span></span>
<span id="cb1-61"><a href="#cb1-61"></a></span>
<span id="cb1-62"><a href="#cb1-62"></a><span class="co"># Open a new graphics device and record the plot history </span></span>
<span id="cb1-63"><a href="#cb1-63"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/windows">windows</a></span>(<span class="dt">record =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1-64"><a href="#cb1-64"></a></span>
<span id="cb1-65"><a href="#cb1-65"></a><span class="co">## y1 vs x</span></span>
<span id="cb1-66"><a href="#cb1-66"></a><span class="co"># Scatter plot</span></span>
<span id="cb1-67"><a href="#cb1-67"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(x, y1, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/adjustcolor">adjustcolor</a></span>(<span class="st">"blue"</span>, <span class="fl">0.2</span>), <span class="dt">main =</span> <span class="st">"Population Scatter Plot"</span>)</span>
<span id="cb1-68"><a href="#cb1-68"></a><span class="co"># Fit a linear regression model y1 ~ x</span></span>
<span id="cb1-69"><a href="#cb1-69"></a>m1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(y1 <span class="op">~</span><span class="st"> </span>x)</span>
<span id="cb1-70"><a href="#cb1-70"></a><span class="co"># Add the regression line to the scatter plot</span></span>
<span id="cb1-71"><a href="#cb1-71"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m1), <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Plot residuals vs fitted from CORRECTLY SPECIFIED linear regression model</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(m1, <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">main =</span> <span class="st">"Population Regression"</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-2.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Compute R squared for later use</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>R2.y1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m1)<span class="op">$</span>r.squared</span>
<span id="cb3-3"><a href="#cb3-3"></a>R2.y1</span></code></pre></div>
<pre><code>## [1] 0.8607507</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">## y2 vs x</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># Scatter plot</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(x, y2, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/adjustcolor">adjustcolor</a></span>(<span class="st">"blue"</span>, <span class="fl">0.2</span>), <span class="dt">main =</span> <span class="st">"Population Scatter Plot"</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># Fit a MISSPECIFIED linear regression model y2 ~ x</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>m2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(y2 <span class="op">~</span><span class="st"> </span>x)</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># Add the WRONG regression line to the scatter plot</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m2), <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-3.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Plot residuals vs fitted from MISSPECIFIED linear regression model</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(m2, <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">main =</span> <span class="st">"Population Regression"</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-4.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Compute R squared for later use</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>R2.y2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m2)<span class="op">$</span>r.squared</span>
<span id="cb7-3"><a href="#cb7-3"></a>R2.y2</span></code></pre></div>
<pre><code>## [1] 0.8965332</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">## y3 vs x</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># Scatter plot</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(x, y3, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/adjustcolor">adjustcolor</a></span>(<span class="st">"blue"</span>, <span class="fl">0.2</span>), <span class="dt">main =</span> <span class="st">"Population Scatter Plot"</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co"># Fit a MISSPECIFIED linear regression model y3 ~ x</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>m3 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(y3 <span class="op">~</span><span class="st"> </span>x)</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co"># Add the WRONG regression line to the scatter plot</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m3), <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-5.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Plot residuals vs fitted from MISSPECIFIED linear regression model</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(m3, <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">main =</span> <span class="st">"Population Regression"</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-6.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Compute R squared for later use</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>R2.y3 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m3)<span class="op">$</span>r.squared</span>
<span id="cb11-3"><a href="#cb11-3"></a>R2.y3</span></code></pre></div>
<pre><code>## [1] 0.5428189</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">## y4 vs x</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co"># The relation between y4 and x is better visualized with a horizontal boxplot</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/boxplot">boxplot</a></span>(x <span class="op">~</span><span class="st"> </span>y4, <span class="dt">horizontal =</span> <span class="ot">TRUE</span>, <span class="dt">xlab =</span> <span class="st">"x"</span>, <span class="dt">ylab =</span> <span class="st">"y4"</span>, <span class="dt">main =</span> <span class="st">"Population Box Plot"</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-7.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Scatter plot (add some noise to y4 to help visualization)</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(x, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/jitter">jitter</a></span>(y4, <span class="fl">0.3</span>), <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/adjustcolor">adjustcolor</a></span>(<span class="st">"blue"</span>, <span class="fl">0.2</span>), <span class="dt">ylab =</span> <span class="st">"y4 (noise added)"</span>, <span class="dt">main =</span> <span class="st">"Population Scatter Plot"</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co"># Fit a MISSPECIFIED linear regression model y4 ~ x</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>m4 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(y4 <span class="op">~</span><span class="st"> </span>x)</span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co"># Add the WRONG regression line to the scatter plot</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(m4), <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-8.png" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Plot residuals vs fitted from MISSPECIFIED linear regression model</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(m4, <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">main =</span> <span class="st">"Population Regression"</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-9.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Compute R squared for later use</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>R2.y4 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(m4)<span class="op">$</span>r.squared</span>
<span id="cb16-3"><a href="#cb16-3"></a>R2.y4</span></code></pre></div>
<pre><code>## [1] 0.2622397</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co">###############################################################</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># Build the universe.                                         #</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co"># We will later use it as a list frame for sample selection.  #</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co">###############################################################</span></span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a>univ &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(x), <span class="dt">x =</span> x, <span class="dt">ones =</span> <span class="dv">1</span>, <span class="dt">y1 =</span> y1, <span class="dt">y2 =</span> y2, <span class="dt">y3 =</span> y3, <span class="dt">y4 =</span> y4)</span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co"># Have a look</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(univ)</span></code></pre></div>
<pre><code>##   id        x ones        y1         y2        y3 y4
## 1  1 76.27683    1 144.31429 1043.94703 179.59684  1
## 2  2 89.44072    1 200.95695 2173.37370 154.58172  1
## 3  3 79.68350    1 173.64394 1795.38574 149.70072  1
## 4  4 90.32059    1 163.02769 1947.66892 283.25679  1
## 5  5 53.80088    1 101.61218  786.72440 201.57965  0
## 6  6 29.14160    1  78.62472   38.29909  44.71282  0</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co">#############################################################</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="co"># Define the sampling design and the sample size to be used #</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="co"># in the Monte Carlo simulation.                            #</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co">#############################################################</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co"># We will select simple random samples without replacement (srs) from univ</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="co"># Sample size n = 100</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>n &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="co"># Sampling fraction (=inclusion probability for srs)</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>f &lt;-<span class="st"> </span>n<span class="op">/</span>N</span>
<span id="cb20-10"><a href="#cb20-10"></a>f</span></code></pre></div>
<pre><code>## [1] 0.02</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Direct weights (=inverse inclusion probabilities) d = 1/p = 1/f</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>d &lt;-<span class="st"> </span>N<span class="op">/</span>n</span>
<span id="cb22-3"><a href="#cb22-3"></a>d</span></code></pre></div>
<pre><code>## [1] 50</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Add convenience columns to univ </span></span>
<span id="cb24-2"><a href="#cb24-2"></a>univ &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(univ, <span class="dt">d =</span> d, <span class="dt">f =</span> f)</span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="co"># Have a look</span></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(univ)</span></code></pre></div>
<pre><code>##   id        x ones        y1         y2        y3 y4  d    f
## 1  1 76.27683    1 144.31429 1043.94703 179.59684  1 50 0.02
## 2  2 89.44072    1 200.95695 2173.37370 154.58172  1 50 0.02
## 3  3 79.68350    1 173.64394 1795.38574 149.70072  1 50 0.02
## 4  4 90.32059    1 163.02769 1947.66892 283.25679  1 50 0.02
## 5  5 53.80088    1 101.61218  786.72440 201.57965  0 50 0.02
## 6  6 29.14160    1  78.62472   38.29909  44.71282  0 50 0.02</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co">#############################################################################</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="co"># Compute known population totals to be later used as calibration controls. #</span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="co">#############################################################################</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>N &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(univ<span class="op">$</span>ones)</span>
<span id="cb26-5"><a href="#cb26-5"></a>N</span></code></pre></div>
<pre><code>## [1] 5000</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>X &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(univ<span class="op">$</span>x)</span>
<span id="cb28-2"><a href="#cb28-2"></a>X</span></code></pre></div>
<pre><code>## [1] 287655.7</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co">#############################################################################</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="co"># Compute true population parameters to be estimated: totals of y1, y2, y3. #</span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="co">#############################################################################</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>Y1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(univ<span class="op">$</span>y1)</span>
<span id="cb30-5"><a href="#cb30-5"></a>Y1</span></code></pre></div>
<pre><code>## [1] 624064.1</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>Y2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(univ<span class="op">$</span>y2)</span>
<span id="cb32-2"><a href="#cb32-2"></a>Y2</span></code></pre></div>
<pre><code>## [1] 4952355</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>Y3 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(univ<span class="op">$</span>y3)</span>
<span id="cb34-2"><a href="#cb34-2"></a>Y3</span></code></pre></div>
<pre><code>## [1] 628791.5</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>Y4 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(univ<span class="op">$</span>y4)</span>
<span id="cb36-2"><a href="#cb36-2"></a>Y4</span></code></pre></div>
<pre><code>## [1] 2858</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>MCsample &lt;-<span class="st"> </span><span class="cf">function</span>(nsamp){</span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="co">#########################################################</span></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="co"># Monte Carlo - Step 1                                  #</span></span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="co"># Select 'nsamp' samples with n=100 from univ under srs #</span></span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="co"># and store them into a list.                           #</span></span>
<span id="cb38-6"><a href="#cb38-6"></a><span class="co">#########################################################</span></span>
<span id="cb38-7"><a href="#cb38-7"></a> samples &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="dv">1</span><span class="op">:</span>nsamp, <span class="cf">function</span>(i) univ[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(<span class="dv">1</span><span class="op">:</span>N, n, <span class="dt">rep =</span> <span class="ot">FALSE</span>), , <span class="dt">drop =</span> <span class="ot">FALSE</span>])</span>
<span id="cb38-8"><a href="#cb38-8"></a> samples</span>
<span id="cb38-9"><a href="#cb38-9"></a>}</span>
<span id="cb38-10"><a href="#cb38-10"></a></span>
<span id="cb38-11"><a href="#cb38-11"></a>MCdesign &lt;-<span class="st"> </span><span class="cf">function</span>(samples){</span>
<span id="cb38-12"><a href="#cb38-12"></a><span class="co">#########################################################</span></span>
<span id="cb38-13"><a href="#cb38-13"></a><span class="co"># Monte Carlo - Step 2                                  #</span></span>
<span id="cb38-14"><a href="#cb38-14"></a><span class="co"># For each sample, bind survey data and sampling design #</span></span>
<span id="cb38-15"><a href="#cb38-15"></a><span class="co"># metadata.                                             #</span></span>
<span id="cb38-16"><a href="#cb38-16"></a><span class="co"># Store the survey design objects into a list.          #</span></span>
<span id="cb38-17"><a href="#cb38-17"></a><span class="co">#########################################################</span></span>
<span id="cb38-18"><a href="#cb38-18"></a> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(ReGenesees)</span>
<span id="cb38-19"><a href="#cb38-19"></a> designs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(samples, <span class="cf">function</span>(sam) <span class="kw"><a href="../reference/e.svydesign.html">e.svydesign</a></span>(sam, <span class="dt">ids =</span> <span class="op">~</span>id, <span class="dt">weights =</span> <span class="op">~</span>d, <span class="dt">fpc =</span> <span class="op">~</span>f))</span>
<span id="cb38-20"><a href="#cb38-20"></a> designs</span>
<span id="cb38-21"><a href="#cb38-21"></a>}</span>
<span id="cb38-22"><a href="#cb38-22"></a></span>
<span id="cb38-23"><a href="#cb38-23"></a>MCcalibrate &lt;-<span class="st"> </span><span class="cf">function</span>(designs, calmodel){</span>
<span id="cb38-24"><a href="#cb38-24"></a><span class="co">#########################################################</span></span>
<span id="cb38-25"><a href="#cb38-25"></a><span class="co"># Monte Carlo - Step 3                                  #</span></span>
<span id="cb38-26"><a href="#cb38-26"></a><span class="co"># Calibrate each survey design object subject to the    #</span></span>
<span id="cb38-27"><a href="#cb38-27"></a><span class="co"># calibration constraints summarized in 'calmodel'.     #</span></span>
<span id="cb38-28"><a href="#cb38-28"></a><span class="co"># Store the calibrated objects into a list.             #</span></span>
<span id="cb38-29"><a href="#cb38-29"></a><span class="co">#########################################################</span></span>
<span id="cb38-30"><a href="#cb38-30"></a> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(ReGenesees)</span>
<span id="cb38-31"><a href="#cb38-31"></a></span>
<span id="cb38-32"><a href="#cb38-32"></a> <span class="co"># Switch off printing to avoid cluttering the screen with useless messages</span></span>
<span id="cb38-33"><a href="#cb38-33"></a> <span class="co"># coming from fill.template</span></span>
<span id="cb38-34"><a href="#cb38-34"></a> trash &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">file</a></span>()</span>
<span id="cb38-35"><a href="#cb38-35"></a> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sink">sink</a></span>(<span class="dt">file =</span> trash)</span>
<span id="cb38-36"><a href="#cb38-36"></a></span>
<span id="cb38-37"><a href="#cb38-37"></a> cal.designs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="st">"list"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(designs))</span>
<span id="cb38-38"><a href="#cb38-38"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(designs)){</span>
<span id="cb38-39"><a href="#cb38-39"></a>      <span class="co"># Build known totals template</span></span>
<span id="cb38-40"><a href="#cb38-40"></a>      pop &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pop.template.html">pop.template</a></span>(designs[[i]], calmodel)</span>
<span id="cb38-41"><a href="#cb38-41"></a>      <span class="co"># Fill known totals template with actual figures</span></span>
<span id="cb38-42"><a href="#cb38-42"></a>      pop &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fill.template.html">fill.template</a></span>(univ, pop)</span>
<span id="cb38-43"><a href="#cb38-43"></a>      <span class="co"># Perform the calibration task</span></span>
<span id="cb38-44"><a href="#cb38-44"></a>      cal.designs[[i]] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/e.calibrate.html">e.calibrate</a></span>(designs[[i]], pop)</span>
<span id="cb38-45"><a href="#cb38-45"></a>    }</span>
<span id="cb38-46"><a href="#cb38-46"></a></span>
<span id="cb38-47"><a href="#cb38-47"></a> <span class="co"># Switch on printing on screen</span></span>
<span id="cb38-48"><a href="#cb38-48"></a> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sink">sink</a></span>()</span>
<span id="cb38-49"><a href="#cb38-49"></a> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">close</a></span>(trash)</span>
<span id="cb38-50"><a href="#cb38-50"></a></span>
<span id="cb38-51"><a href="#cb38-51"></a> cal.designs</span>
<span id="cb38-52"><a href="#cb38-52"></a>}</span>
<span id="cb38-53"><a href="#cb38-53"></a></span>
<span id="cb38-54"><a href="#cb38-54"></a></span>
<span id="cb38-55"><a href="#cb38-55"></a></span>
<span id="cb38-56"><a href="#cb38-56"></a><span class="co">####################################################################</span></span>
<span id="cb38-57"><a href="#cb38-57"></a><span class="co"># Run our toy Monte Carlo experiment with a bunch of 2000 samples. #</span></span>
<span id="cb38-58"><a href="#cb38-58"></a><span class="co">####################################################################</span></span>
<span id="cb38-59"><a href="#cb38-59"></a>nsamp &lt;-<span class="st"> </span><span class="dv">2000</span></span>
<span id="cb38-60"><a href="#cb38-60"></a></span>
<span id="cb38-61"><a href="#cb38-61"></a><span class="co">## Select samples</span></span>
<span id="cb38-62"><a href="#cb38-62"></a>samples &lt;-<span class="st"> </span><span class="kw">MCsample</span>(nsamp)</span>
<span id="cb38-63"><a href="#cb38-63"></a></span>
<span id="cb38-64"><a href="#cb38-64"></a><span class="co">## Generate sampling design objects</span></span>
<span id="cb38-65"><a href="#cb38-65"></a>designs &lt;-<span class="st"> </span><span class="kw">MCdesign</span>(samples)</span></code></pre></div>
<pre><code>## Loading required package: ReGenesees</code></pre>
<pre><code>## </code></pre>
<pre><code>## --------------------------------------------------------</code></pre>
<pre><code>## &gt; The ReGenesees package has been successfully loaded. &lt;</code></pre>
<pre><code>## --------------------------------------------------------</code></pre>
<pre><code>## </code></pre>
<pre><code>## Package: ReGenesees
## Type: Package
## Title: R Evolved Generalized Software for Sampling Estimates and Errors
##         in Surveys
## Description: Design-Based and Model-Assisted analysis of complex
##         sampling surveys. Multistage, stratified, clustered, unequally
##         weighted survey designs. Horvitz-Thompson and Calibration
##         Estimators. Variance Estimation for nonlinear smooth estimators
##         by Taylor-series linearization. Estimates, standard errors,
##         confidence intervals and design effects for: Totals, Means,
##         absolute and relative Frequency Distributions (marginal,
##         conditional and joint), Ratios, Shares and Ratios of Shares,
##         Multiple Regression Coefficients and Quantiles. Automated
##         Linearization of Complex Analytic Estimators. Design Covariance
##         and Correlation. Estimates, standard errors, confidence
##         intervals and design effects for user-defined analytic
##         estimators. Estimates and sampling errors for subpopulations.
##         Consistent trimming of calibration weights. Generalized
##         Variance Functions (GVF) method for predicting variance
##         estimates.
## Version: 2.0
## Author: Diego Zardetto
## Maintainer: Diego Zardetto &lt;zardetto@istat.it&gt;
## License: EUPL
## Imports: stats, MASS
## Depends: R (&gt;= 2.14.0)
## ByteCompile: TRUE
## Built: R 4.0.0; ; 2020-05-13 11:19:24 UTC; windows</code></pre>
<pre><code>## </code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co">## Calibrate design objects</span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="co"># Auxiliary information is N and X, hence</span></span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="co"># calmodel = ~x + ones - 1</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>cal.designs &lt;-<span class="st"> </span><span class="kw">MCcalibrate</span>(designs, <span class="op">~</span>x <span class="op">+</span><span class="st"> </span>ones <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb47-5"><a href="#cb47-5"></a></span>
<span id="cb47-6"><a href="#cb47-6"></a></span>
<span id="cb47-7"><a href="#cb47-7"></a></span>
<span id="cb47-8"><a href="#cb47-8"></a><span class="co">#################################################</span></span>
<span id="cb47-9"><a href="#cb47-9"></a><span class="co"># Experiment 1 - Interest variable is y1        #</span></span>
<span id="cb47-10"><a href="#cb47-10"></a><span class="co"># Compute and compare Horvitz-Thompson (HT) and #</span></span>
<span id="cb47-11"><a href="#cb47-11"></a><span class="co"># calibration (CAL) estimators of totals.       #</span></span>
<span id="cb47-12"><a href="#cb47-12"></a><span class="co">#################################################</span></span>
<span id="cb47-13"><a href="#cb47-13"></a><span class="co"># HT</span></span>
<span id="cb47-14"><a href="#cb47-14"></a>Y1ht &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(designs, <span class="cf">function</span>(des) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(<span class="kw"><a href="../reference/svystatTM.html">svystatTM</a></span>(des, <span class="dt">y =</span> <span class="op">~</span>y1)))</span>
<span id="cb47-15"><a href="#cb47-15"></a><span class="co"># Cal</span></span>
<span id="cb47-16"><a href="#cb47-16"></a>Y1cal &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(cal.designs, <span class="cf">function</span>(des) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(<span class="kw"><a href="../reference/svystatTM.html">svystatTM</a></span>(des, <span class="dt">y =</span> <span class="op">~</span>y1)))</span>
<span id="cb47-17"><a href="#cb47-17"></a></span>
<span id="cb47-18"><a href="#cb47-18"></a><span class="co">## Compare MC generated Y1ht and Y1cal estimates via scatter plots</span></span>
<span id="cb47-19"><a href="#cb47-19"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(Y1ht, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">ylab =</span> <span class="st">"Yht (black) and Ycal (red)"</span>, <span class="dt">main =</span> <span class="st">"Estimated Totals of y1"</span>)</span>
<span id="cb47-20"><a href="#cb47-20"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(Y1cal, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">pch =</span> <span class="dv">19</span>)</span>
<span id="cb47-21"><a href="#cb47-21"></a><span class="co"># Add TRUE value of Y1 as reference line</span></span>
<span id="cb47-22"><a href="#cb47-22"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">h =</span> Y1, <span class="dt">col =</span> <span class="st">"blue"</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-10.png" width="700"></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co">## Compare MC generated Y1ht and Y1cal via density plots</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(Y1cal), <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/range">range</a></span>(Y1ht, Y1cal), <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">main =</span> <span class="st">"Density Plots of Estimated Totals of y1</span><span class="ch">\n</span><span class="st">Yht (black) and Ycal (red)"</span>)</span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(Y1ht), <span class="dt">type=</span><span class="st">"l"</span>)</span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="co"># Add TRUE value of Y1 as reference line</span></span>
<span id="cb48-5"><a href="#cb48-5"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">v =</span> Y1, <span class="dt">col =</span> <span class="st">"blue"</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-11.png" width="700"></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co">## Assess the variance reduction achieved by calibration through MC...</span></span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(Y1cal)<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(Y1ht)</span></code></pre></div>
<pre><code>## [1] 0.1312868</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># ...the gain should be roughly of order 1 - R2 </span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R2.y1</span></code></pre></div>
<pre><code>## [1] 0.1392493</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co">## Check that going from HT to CAL does NOT introduce substantial BIAS</span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="co">## HT Relative Bias from MC...</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>RB.Y1ht &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(Y1ht) <span class="op">-</span><span class="st"> </span>Y1)<span class="op">/</span>Y1</span>
<span id="cb53-4"><a href="#cb53-4"></a>RB.Y1ht</span></code></pre></div>
<pre><code>## [1] -0.0006889486</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co">## CAL Relative Bias from MC...</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>RB.Y1cal &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(Y1cal) <span class="op">-</span><span class="st"> </span>Y1)<span class="op">/</span>Y1</span>
<span id="cb55-3"><a href="#cb55-3"></a>RB.Y1cal</span></code></pre></div>
<pre><code>## [1] 1.514882e-05</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># End</span></span>
<span id="cb57-2"><a href="#cb57-2"></a></span>
<span id="cb57-3"><a href="#cb57-3"></a></span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="co">########################################################</span></span>
<span id="cb57-5"><a href="#cb57-5"></a><span class="co"># Experiment 2 - Interest variable is y2               #</span></span>
<span id="cb57-6"><a href="#cb57-6"></a><span class="co"># Compute and compare HT and CAL estimators of totals. #</span></span>
<span id="cb57-7"><a href="#cb57-7"></a><span class="co">########################################################</span></span>
<span id="cb57-8"><a href="#cb57-8"></a><span class="co"># HT</span></span>
<span id="cb57-9"><a href="#cb57-9"></a>Y2ht &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(designs, <span class="cf">function</span>(des) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(<span class="kw"><a href="../reference/svystatTM.html">svystatTM</a></span>(des, <span class="dt">y =</span> <span class="op">~</span>y2)))</span>
<span id="cb57-10"><a href="#cb57-10"></a><span class="co"># Cal</span></span>
<span id="cb57-11"><a href="#cb57-11"></a>Y2cal &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(cal.designs, <span class="cf">function</span>(des) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(<span class="kw"><a href="../reference/svystatTM.html">svystatTM</a></span>(des, <span class="dt">y =</span> <span class="op">~</span>y2)))</span>
<span id="cb57-12"><a href="#cb57-12"></a></span>
<span id="cb57-13"><a href="#cb57-13"></a><span class="co">## Compare MC generated Y2ht and Y2cal estimates via scatter plots</span></span>
<span id="cb57-14"><a href="#cb57-14"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(Y2ht, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">ylab =</span> <span class="st">"Yht (black) and Ycal (red)"</span>, <span class="dt">main =</span> <span class="st">"Estimated Totals of y2"</span>)</span>
<span id="cb57-15"><a href="#cb57-15"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(Y2cal, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">pch =</span> <span class="dv">19</span>)</span>
<span id="cb57-16"><a href="#cb57-16"></a><span class="co"># Add TRUE value of Y2 as reference line</span></span>
<span id="cb57-17"><a href="#cb57-17"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">h =</span> Y2, <span class="dt">col =</span> <span class="st">"blue"</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-12.png" width="700"></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co">## Compare MC generated Y2ht and Y2cal via density plots</span></span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(Y2cal), <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/range">range</a></span>(Y2ht, Y2cal), <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">main =</span> <span class="st">"Density Plots of Estimated Totals of y2</span><span class="ch">\n</span><span class="st">Yht (black) and Ycal (red)"</span>)</span>
<span id="cb58-3"><a href="#cb58-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(Y2ht), <span class="dt">type=</span><span class="st">"l"</span>)</span>
<span id="cb58-4"><a href="#cb58-4"></a><span class="co"># Add TRUE value of Y2 as reference line</span></span>
<span id="cb58-5"><a href="#cb58-5"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">v =</span> Y2, <span class="dt">col =</span> <span class="st">"blue"</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-13.png" width="700"></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co">## Assess the variance reduction achieved by calibration through MC...</span></span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(Y2cal)<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(Y2ht)</span></code></pre></div>
<pre><code>## [1] 0.104427</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># ...the gain should be roughly of order 1 - R2 </span></span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R2.y2</span></code></pre></div>
<pre><code>## [1] 0.1034668</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co">## Check that going from HT to CAL does NOT introduce substantial BIAS</span></span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="co">## HT Relative Bias from MC...</span></span>
<span id="cb63-3"><a href="#cb63-3"></a>RB.Y2ht &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(Y2ht) <span class="op">-</span><span class="st"> </span>Y2)<span class="op">/</span>Y2</span>
<span id="cb63-4"><a href="#cb63-4"></a>RB.Y2ht</span></code></pre></div>
<pre><code>## [1] -0.0007183598</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="co">## CAL Relative Bias from MC...</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>RB.Y2cal &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(Y2cal) <span class="op">-</span><span class="st"> </span>Y2)<span class="op">/</span>Y2</span>
<span id="cb65-3"><a href="#cb65-3"></a>RB.Y2cal</span></code></pre></div>
<pre><code>## [1] -0.0007507708</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># End</span></span>
<span id="cb67-2"><a href="#cb67-2"></a></span>
<span id="cb67-3"><a href="#cb67-3"></a></span>
<span id="cb67-4"><a href="#cb67-4"></a><span class="co">########################################################</span></span>
<span id="cb67-5"><a href="#cb67-5"></a><span class="co"># Experiment 3 - Interest variable is y3               #</span></span>
<span id="cb67-6"><a href="#cb67-6"></a><span class="co"># Compute and compare HT and CAL estimators of totals. #</span></span>
<span id="cb67-7"><a href="#cb67-7"></a><span class="co">########################################################</span></span>
<span id="cb67-8"><a href="#cb67-8"></a><span class="co"># HT</span></span>
<span id="cb67-9"><a href="#cb67-9"></a>Y3ht &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(designs, <span class="cf">function</span>(des) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(<span class="kw"><a href="../reference/svystatTM.html">svystatTM</a></span>(des, <span class="dt">y =</span> <span class="op">~</span>y3)))</span>
<span id="cb67-10"><a href="#cb67-10"></a><span class="co"># Cal</span></span>
<span id="cb67-11"><a href="#cb67-11"></a>Y3cal &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(cal.designs, <span class="cf">function</span>(des) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(<span class="kw"><a href="../reference/svystatTM.html">svystatTM</a></span>(des, <span class="dt">y =</span> <span class="op">~</span>y3)))</span>
<span id="cb67-12"><a href="#cb67-12"></a></span>
<span id="cb67-13"><a href="#cb67-13"></a><span class="co">## Compare MC generated Y3ht and Y3cal estimates via scatter plots</span></span>
<span id="cb67-14"><a href="#cb67-14"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(Y3ht, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">ylab =</span> <span class="st">"Yht (black) and Ycal (red)"</span>, <span class="dt">main =</span> <span class="st">"Estimated Totals of y3"</span>)</span>
<span id="cb67-15"><a href="#cb67-15"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(Y3cal, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">pch =</span> <span class="dv">19</span>)</span>
<span id="cb67-16"><a href="#cb67-16"></a><span class="co"># Add TRUE value of Y3 as reference line</span></span>
<span id="cb67-17"><a href="#cb67-17"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">h =</span> Y3, <span class="dt">col =</span> <span class="st">"blue"</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-14.png" width="700"></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co">## Compare MC generated Y3ht and Y3cal via density plots</span></span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(Y3cal), <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/range">range</a></span>(Y3ht, Y3cal), <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">main =</span> <span class="st">"Density Plots of Estimated Totals of y3</span><span class="ch">\n</span><span class="st">Yht (black) and Ycal (red)"</span>)</span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(Y3ht), <span class="dt">type=</span><span class="st">"l"</span>)</span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="co"># Add TRUE value of Y3 as reference line</span></span>
<span id="cb68-5"><a href="#cb68-5"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">v =</span> Y3, <span class="dt">col =</span> <span class="st">"blue"</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-15.png" width="700"></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co">## Assess the variance reduction achieved by calibration through MC...</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(Y3cal)<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(Y3ht)</span></code></pre></div>
<pre><code>## [1] 0.4366279</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="co"># ...the gain should be roughly of order 1 - R2 </span></span>
<span id="cb71-2"><a href="#cb71-2"></a><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R2.y3</span></code></pre></div>
<pre><code>## [1] 0.4571811</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="co">## Check that going from HT to CAL does NOT introduce substantial BIAS</span></span>
<span id="cb73-2"><a href="#cb73-2"></a><span class="co">## HT Relative Bias from MC...</span></span>
<span id="cb73-3"><a href="#cb73-3"></a>RB.Y3ht &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(Y3ht) <span class="op">-</span><span class="st"> </span>Y3)<span class="op">/</span>Y3</span>
<span id="cb73-4"><a href="#cb73-4"></a>RB.Y3ht</span></code></pre></div>
<pre><code>## [1] -0.002358876</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="co">## CAL Relative Bias from MC...</span></span>
<span id="cb75-2"><a href="#cb75-2"></a>RB.Y3cal &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(Y3cal) <span class="op">-</span><span class="st"> </span>Y3)<span class="op">/</span>Y3</span>
<span id="cb75-3"><a href="#cb75-3"></a>RB.Y3cal</span></code></pre></div>
<pre><code>## [1] -0.001762946</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="co"># End</span></span>
<span id="cb77-2"><a href="#cb77-2"></a></span>
<span id="cb77-3"><a href="#cb77-3"></a></span>
<span id="cb77-4"><a href="#cb77-4"></a><span class="co">########################################################</span></span>
<span id="cb77-5"><a href="#cb77-5"></a><span class="co"># Experiment 4 - Interest variable is y4               #</span></span>
<span id="cb77-6"><a href="#cb77-6"></a><span class="co"># Compute and compare HT and CAL estimators of totals. #</span></span>
<span id="cb77-7"><a href="#cb77-7"></a><span class="co">########################################################</span></span>
<span id="cb77-8"><a href="#cb77-8"></a><span class="co"># HT</span></span>
<span id="cb77-9"><a href="#cb77-9"></a>Y4ht &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(designs, <span class="cf">function</span>(des) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(<span class="kw"><a href="../reference/svystatTM.html">svystatTM</a></span>(des, <span class="dt">y =</span> <span class="op">~</span>y4)))</span>
<span id="cb77-10"><a href="#cb77-10"></a><span class="co"># Cal</span></span>
<span id="cb77-11"><a href="#cb77-11"></a>Y4cal &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(cal.designs, <span class="cf">function</span>(des) <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(<span class="kw"><a href="../reference/svystatTM.html">svystatTM</a></span>(des, <span class="dt">y =</span> <span class="op">~</span>y4)))</span>
<span id="cb77-12"><a href="#cb77-12"></a></span>
<span id="cb77-13"><a href="#cb77-13"></a><span class="co">## Compare MC generated Y4ht and Y4cal estimates via scatter plots</span></span>
<span id="cb77-14"><a href="#cb77-14"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(Y4ht, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">ylab =</span> <span class="st">"Yht (black) and Ycal (red)"</span>, <span class="dt">main =</span> <span class="st">"Estimated Totals of y4"</span>)</span>
<span id="cb77-15"><a href="#cb77-15"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(Y4cal, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">pch =</span> <span class="dv">19</span>)</span>
<span id="cb77-16"><a href="#cb77-16"></a><span class="co"># Add TRUE value of Y4 as reference line</span></span>
<span id="cb77-17"><a href="#cb77-17"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">h =</span> Y4, <span class="dt">col =</span> <span class="st">"blue"</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-16.png" width="700"></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="co">## Compare MC generated Y4ht and Y4cal via density plots</span></span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(Y4cal), <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/range">range</a></span>(Y4ht, Y4cal), <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">main =</span> <span class="st">"Density Plots of Estimated Totals of y4</span><span class="ch">\n</span><span class="st">Yht (black) and Ycal (red)"</span>)</span>
<span id="cb78-3"><a href="#cb78-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/density">density</a></span>(Y4ht), <span class="dt">type=</span><span class="st">"l"</span>)</span>
<span id="cb78-4"><a href="#cb78-4"></a><span class="co"># Add TRUE value of Y4 as reference line</span></span>
<span id="cb78-5"><a href="#cb78-5"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/abline">abline</a></span>(<span class="dt">v =</span> Y4, <span class="dt">col =</span> <span class="st">"blue"</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Calibration_Efficiency_MC_files/figure-html/unnamed-chunk-1-17.png" width="700"></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="co">## Assess the variance reduction achieved by calibration through MC...</span></span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(Y4cal)<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var</a></span>(Y4ht)</span></code></pre></div>
<pre><code>## [1] 0.757955</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="co"># ...the gain should be roughly of order 1 - R2 </span></span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>R2.y4</span></code></pre></div>
<pre><code>## [1] 0.7377603</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co">## Check that going from HT to CAL does NOT introduce substantial BIAS</span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="co">## HT Relative Bias from MC...</span></span>
<span id="cb83-3"><a href="#cb83-3"></a>RB.Y4ht &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(Y4ht) <span class="op">-</span><span class="st"> </span>Y4)<span class="op">/</span>Y4</span>
<span id="cb83-4"><a href="#cb83-4"></a>RB.Y4ht</span></code></pre></div>
<pre><code>## [1] 0.001075927</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="co">## CAL Relative Bias from MC...</span></span>
<span id="cb85-2"><a href="#cb85-2"></a>RB.Y4cal &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(Y4cal) <span class="op">-</span><span class="st"> </span>Y4)<span class="op">/</span>Y4</span>
<span id="cb85-3"><a href="#cb85-3"></a>RB.Y4cal</span></code></pre></div>
<pre><code>## [1] 0.002151844</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="co"># End</span></span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Diego Zardetto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
