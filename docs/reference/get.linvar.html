<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Linearized Variable(s) of Complex Estimators by Domains — get.linvar • ReGenesees</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Linearized Variable(s) of Complex Estimators by Domains — get.linvar" />
<meta property="og:description" content="Computes the linearized variable(s) of a Complex Estimator in subpopulations (domains). The Complex Estimator can be any analytic function of Horvitz-Thompson or Calibration estimators." />
<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ReGenesees</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Calibration_Efficiency_MC.html">On the Efficiency Gain of Calibration Estimators</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/DiegoZardetto/ReGenesees">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Linearized Variable(s) of Complex Estimators by Domains</h1>
    
    <div class="hidden name"><code>get.linvar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Computes the linearized variable(s) of a Complex Estimator in subpopulations (domains). The Complex Estimator can be any analytic function of Horvitz-Thompson or Calibration estimators.</p>
    </div>

    <pre class="usage"><span class='fu'>get.linvar</span>(<span class='no'>design</span>, <span class='no'>expr</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>stack</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>design</th>
      <td><p>Object of class <code>analytic</code> (or inheriting from it) containing survey data and sampling design metadata. Can be either uncalibrated or calibrated.</p></td>
    </tr>
    <tr>
      <th>expr</th>
      <td><p>R expression defining the Complex Estimator (see <code><a href='svystatL.html'>svystatL</a></code> for the basic syntax; see also section &#8216;Details&#8217;).</p></td>
    </tr>
    <tr>
      <th>by</th>
      <td><p>Formula specifying the variables that define the "estimation domains". If <code>NULL</code>
           (the default option) the estimator refers to the whole population.</p></td>
    </tr>
    <tr>
      <th>stack</th>
      <td><p>If <code>FALSE</code> (the default), the function will return a <code>matrix</code> of domain-specific linearized variables, with one column per domain. If <code>TRUE</code>, the domain-specific linearized variables will be stacked without information loss and returned as a single column. The <em>stacked</em> output format is only possible for <em>uncalibrated</em> designs (see &#8216;Details&#8217;).</p></td>
    </tr>
    <tr>
      <th>na.rm</th>
      <td><p>Allow missing values in the variables entering the estimator expression? The default is
              <code>FALSE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function has been designed mainly for programmers or advanced users willing to build upon <span class="pkg">ReGenesees</span>: typical users are not expected to feel much need of it.</p>
<p>The <span class="pkg">ReGenesees</span> package adopts the Taylor-series linearization technique to estimate the sampling variance of nonlinear (smooth) estimators. Using this technique, it can handle any Complex Estimator that can be expressed as an analytic function of Horvitz-Thompson or Calibration estimators. This includes even user-defined estimators, through function <code><a href='svystatL.html'>svystatL</a></code> [Zardetto, 15].</p>
<p>In the Taylor-series linearization approach, estimating the sampling variance of a Complex Estimator amounts to estimating the sampling variance of the Horvitz-Thompson estimator of the total of the <em>linearized variable</em> of the Complex Estimator under the sampling design at hand. Function <code>get.linvar</code> computes that linearized variable. If one is interested in estimating the sampling variance of a Complex Estimator by <em>domains</em> (i.e. for subpopulations), then - owing to the Taylor linearization technique - a different linearized variable has to be calculated for each domain. Therefore, in the most general case, the output of function <code>get.linvar</code> will be a <code>matrix</code> of linearized variables, with one column per domain.</p>
<p>If the input object <code>design</code> is calibrated, then the linearized variable produced by function <code>get.linvar</code> correctly takes into account the theoretical properties of Calibration estimators (see, e.g., [Deville, 1999]). In particular, <code>get.linvar</code> computes the needed g-weighted residuals (see, e.g., equations (8) and (9) of [Zardetto, 15]) by leveraging function <code><a href='get.residuals.html'>get.residuals</a></code>.</p>
<p>The mandatory argument <code>expr</code>, which identifies the Complex Estimator, must be an object of class <code>expression</code>. You can specify just a single Complex Estimator at a time, i.e. <code><a href='https://rdrr.io/r/base/length.html'>length(expr)</a></code> must be equal to <code>1</code>. Any analytic function of estimators of Totals and Means derived from the input design object <code>design</code> is allowed.</p>
<p>The basic syntax follows the same rules described for function <code><a href='svystatL.html'>svystatL</a></code>. Inside <code>expr</code>, the estimator of the Total of a variable is simply represented by the <em>name</em> of the variable itself. The reserved name <code>ones</code> can be used to reference an artificial variable (which will be created on-the-fly, if not already present) whose value is <code>1</code> for each sampling unit, so that its Total estimator actually estimates the size of the population in terms of elementary units. Therefore, e.g., expression <code>y/ones</code> represents the estimator of the Mean of variable <code>y</code>. Variables referenced inside <code>expr</code> must be <code>numeric</code> and belong to <code>design</code>.</p>
<p>The optional argument <code>by</code> specifies the variables that define the "estimation domains", that is the subpopulations for which the estimates are to be calculated. If <code>by=NULL</code> (the default option), the estimates produced by <code>svystatL</code> refer to the whole population. Estimation domains must be defined by a formula: for example the statement <code>by=~B1:B2</code> selects as estimation domains the subpopulations determined by crossing the modalities of variables <code>B1</code> and <code>B2</code>. Notice that a formula like <code>by=~B1+B2</code> will be automatically translated into the factor-crossing formula <code>by=~B1:B2</code>: if you need to compute estimates for domains <code>B1</code> and <code>B2</code> <em>separately</em>, you have to call <code>svystatL</code> twice. The <code>design</code> variables referenced by <code>by</code> (if any) should be of type <code>factor</code>, otherwise they will be coerced.</p>
<p>As already noted, in the most general case, the output of function <code>get.linvar</code> will be a <code>matrix</code> of linearized variables, with one column per domain. However, the linearized variable of any <em>domain estimator</em> that is a function of Horvitz-Thompson estimators is identically equal to zero outside the domain. Thanks to this property, and only for functions of HT estimators, the columns of the output matrix can be stacked into one single column without information loss. Users may request this convenient output format by specifying <code>stack = TRUE</code>. Unfortunately, the same result cannot be obtained for functions of Calibration estimators, because the g-weighted residuals are generally non-zero outside the active estimation domain. Therefore, argument <code>stack</code> does nothing if <code>design</code> is calibrated.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A matrix of linearized variables.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Deville, J. C. (1999) <em>&#8220;Variance Estimation for Complex Statistics and Estimators: Linearization and Residual Techniques.&#8221;</em>. Survey Methodology 25: 193-203.</p>
<p>Zardetto, D. (2015) <em>&#8220;ReGenesees: an Advanced R System for Calibration, Estimation and Sampling Error Assessment in Complex Sample Surveys&#8221;</em>. Journal of Official Statistics, 31(2), 177-203. doi: https://doi.org/10.1515/jos-2015-0013.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='svystatL.html'>svystatL</a></code> to calculate estimates and sampling errors of Complex Estimators, <code><a href='get.residuals.html'>get.residuals</a></code> to compute residuals of interest variables w.r.t. the calibration model adopted to build a calibrated object.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Load sbs data:</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>sbs</span>)

<span class='co'># Create a design object to be calibrated:</span>
<span class='no'>sbsdes</span><span class='kw'>&lt;-</span><span class='fu'><a href='e.svydesign.html'>e.svydesign</a></span>(<span class='kw'>data</span><span class='kw'>=</span> <span class='no'>sbs</span>, <span class='kw'>ids</span><span class='kw'>=</span> ~<span class='no'>id</span>, <span class='kw'>strata</span><span class='kw'>=</span> ~<span class='no'>strata</span>, <span class='kw'>weights</span><span class='kw'>=</span> ~<span class='no'>weight</span>, <span class='kw'>fpc</span><span class='kw'>=</span> ~<span class='no'>fpc</span>)

<span class='co'>##################################################################</span>
<span class='co'># Just some checks on the consistency of the numerical results   #</span>
<span class='co'># obtained by ReGenesees with well known theoretical properties. #</span>
<span class='co'>##################################################################</span>

<span class='co'>## In the Taylor-series linearization approach, estimating the sampling variance of a</span>
<span class='co'>## Complex Estimator amounts to estimating the sampling variance of the Horvitz-Thompson</span>
<span class='co'>## estimator of the total of the linearized variable of the Complex Estimator under the</span>
<span class='co'>## sampling design at hand.</span>

<span class='co'>#############</span>
<span class='co'>## Check 1 ##</span>
<span class='co'>#############</span>
<span class='co'># Global estimate (i.e., no domains) of a nonlinear function of HT estimators:</span>
<span class='co'># - Average value added per employee</span>

<span class='co'># Compute the linearized variable of the estimator:</span>
<span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'>get.linvar</span>(<span class='no'>sbsdes</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>))

<span class='co'># Have a look: </span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>z</span>)</div><div class='output co'>#&gt;               z
#&gt; 1  0.0033787523
#&gt; 2 -0.0002174877
#&gt; 3 -0.0010440456
#&gt; 4 -0.0012760633
#&gt; 5 -0.0016815759
#&gt; 6 -0.0028392399</div><div class='input'>
<span class='co'># Now add that variable to the input design object:</span>
<span class='no'>sbsdes</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='des.addvars.html'>des.addvars</a></span>(<span class='no'>sbsdes</span>, <span class='kw'>z</span> <span class='kw'>=</span> <span class='no'>z</span>)

<span class='co'># Now compute the estimated standard error of the HT total of the linearized variable:</span>
<span class='fu'><a href='svystatTM.html'>svystatTM</a></span>(<span class='no'>sbsdes</span>, ~<span class='no'>z</span>)</div><div class='output co'>#&gt;           Total       SE
#&gt; z -1.111315e-14 1.018897</div><div class='input'>
<span class='co'># And compare it to the estimated standard error of the complex estimator:</span>
<span class='fu'><a href='svystatL.html'>svystatL</a></span>(<span class='no'>sbsdes</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>))</div><div class='output co'>#&gt;                  Complex       SE
#&gt; va.imp2/emp.num 57.14199 1.018897</div><div class='input'>
<span class='co'># ...which - in this case - can equivalently be obtained exploiting its ratio nature:</span>
<span class='fu'><a href='svystatR.html'>svystatR</a></span>(<span class='no'>sbsdes</span>, <span class='kw'>num</span> <span class='kw'>=</span> ~<span class='no'>va.imp2</span>, <span class='kw'>den</span><span class='kw'>=</span> ~<span class='no'>emp.num</span>)</div><div class='output co'>#&gt;                    Ratio       SE
#&gt; va.imp2/emp.num 57.14199 1.018897</div><div class='input'>
<span class='co'># Test the equality of the results:</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span>(<span class='fu'><a href='svystatTM.html'>svystatTM</a></span>(<span class='no'>sbsdes</span>, ~<span class='no'>z</span>)$<span class='no'>SE</span>,
          <span class='fu'><a href='svystatL.html'>svystatL</a></span>(<span class='no'>sbsdes</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>))$<span class='no'>SE</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='co'># OK</span>

<span class='co'>#############</span>
<span class='co'>## Check 2 ##</span>
<span class='co'>#############</span>
<span class='co'># Domain estimates of a nonlinear function of HT estimators:</span>
<span class='co'># - Average value added per employee by NACE macro-sectors</span>

<span class='co'># Compute the linearized variable(s) of the domain estimator(s):</span>
<span class='no'>z.dom</span> <span class='kw'>&lt;-</span> <span class='fu'>get.linvar</span>(<span class='no'>sbsdes</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>), <span class='kw'>by</span> <span class='kw'>=</span> ~<span class='no'>nace.macro</span>)

<span class='co'># Have a look: </span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>z.dom</span>)</div><div class='output co'>#&gt;      z_Agriculture z_Industry z_Commerce z_Services
#&gt; [1,]    0.19211694          0          0          0
#&gt; [2,]   -0.01512942          0          0          0
#&gt; [3,]   -0.06249362          0          0          0
#&gt; [4,]   -0.07565296          0          0          0
#&gt; [5,]   -0.09969501          0          0          0
#&gt; [6,]   -0.16841719          0          0          0</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span>(<span class='no'>z.dom</span>)</div><div class='output co'>#&gt;         z_Agriculture z_Industry z_Commerce    z_Services
#&gt; [6904,]             0          0          0 -0.0045717747
#&gt; [6905,]             0          0          0 -0.0012016249
#&gt; [6906,]             0          0          0 -0.0011432199
#&gt; [6907,]             0          0          0 -0.0013394175
#&gt; [6908,]             0          0          0 -0.0005712673
#&gt; [6909,]             0          0          0 -0.0006619357</div><div class='input'>
<span class='co'># Note the staggered matrix-format of the result. Since you are dealing with HT estimators</span>
<span class='co'># (namely sbsdes is not calibrated), you can opt for the more convenient (but equivalent)</span>
<span class='co'># stacked format:</span>
<span class='no'>z.dom</span> <span class='kw'>&lt;-</span> <span class='fu'>get.linvar</span>(<span class='no'>sbsdes</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>), <span class='kw'>by</span> <span class='kw'>=</span> ~<span class='no'>nace.macro</span>, <span class='kw'>stack</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'># Have a look: </span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>z.dom</span>)</div><div class='output co'>#&gt;      z_nace.macro
#&gt; [1,]   0.19211694
#&gt; [2,]  -0.01512942
#&gt; [3,]  -0.06249362
#&gt; [4,]  -0.07565296
#&gt; [5,]  -0.09969501
#&gt; [6,]  -0.16841719</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span>(<span class='no'>z.dom</span>)</div><div class='output co'>#&gt;          z_nace.macro
#&gt; [6904,] -0.0045717747
#&gt; [6905,] -0.0012016249
#&gt; [6906,] -0.0011432199
#&gt; [6907,] -0.0013394175
#&gt; [6908,] -0.0005712673
#&gt; [6909,] -0.0006619357</div><div class='input'>
<span class='co'># Now add that variable to the input design object:</span>
<span class='no'>sbsdes</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='des.addvars.html'>des.addvars</a></span>(<span class='no'>sbsdes</span>, <span class='kw'>z.dom</span> <span class='kw'>=</span> <span class='no'>z.dom</span>)

<span class='co'># Now compute the estimated standard error of the HT total of the linearized variable by</span>
<span class='co'># domains:</span>
<span class='fu'><a href='svystatTM.html'>svystatTM</a></span>(<span class='no'>sbsdes</span>, ~<span class='no'>z.dom</span>, <span class='kw'>by</span><span class='kw'>=</span> ~<span class='no'>nace.macro</span>)</div><div class='output co'>#&gt;              nace.macro   Total.z.dom SE.Total.z.dom
#&gt; Agriculture Agriculture  3.761748e-15      3.2226705
#&gt; Industry       Industry -4.964047e-15      0.6580034
#&gt; Commerce       Commerce -3.002329e-14     12.9021106
#&gt; Services       Services  3.586974e-15      0.5767339</div><div class='input'>
<span class='co'># And compare it to the estimated standard error of the complex estimator:</span>
<span class='fu'><a href='svystatL.html'>svystatL</a></span>(<span class='no'>sbsdes</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>), <span class='kw'>by</span><span class='kw'>=</span> ~<span class='no'>nace.macro</span>)</div><div class='output co'>#&gt;              nace.macro va.imp2/emp.num SE.va.imp2/emp.num
#&gt; Agriculture Agriculture        58.59297          3.2226705
#&gt; Industry       Industry        47.93647          0.6580034
#&gt; Commerce       Commerce       226.99062         12.9021106
#&gt; Services       Services        36.89123          0.5767339</div><div class='input'>
<span class='co'># ...which - in this case - can equivalently be obtained exploiting its ratio nature:</span>
<span class='fu'><a href='svystatR.html'>svystatR</a></span>(<span class='no'>sbsdes</span>, <span class='kw'>num</span> <span class='kw'>=</span> ~<span class='no'>va.imp2</span>, <span class='kw'>den</span><span class='kw'>=</span> ~<span class='no'>emp.num</span>, <span class='kw'>by</span><span class='kw'>=</span> ~<span class='no'>nace.macro</span>)</div><div class='output co'>#&gt;              nace.macro va.imp2/emp.num SE.va.imp2/emp.num
#&gt; Agriculture Agriculture        58.59297          3.2226705
#&gt; Industry       Industry        47.93647          0.6580034
#&gt; Commerce       Commerce       226.99062         12.9021106
#&gt; Services       Services        36.89123          0.5767339</div><div class='input'>
<span class='co'># Test the equality of the results:</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span>(<span class='fu'><a href='svystatTM.html'>svystatTM</a></span>(<span class='no'>sbsdes</span>, ~<span class='no'>z.dom</span>, <span class='kw'>by</span><span class='kw'>=</span> ~<span class='no'>nace.macro</span>)$<span class='no'>SE</span>,
          <span class='fu'><a href='svystatL.html'>svystatL</a></span>(<span class='no'>sbsdes</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>), <span class='kw'>by</span><span class='kw'>=</span> ~<span class='no'>nace.macro</span>)$<span class='no'>SE</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='co'># OK</span>

<span class='co'>###################################################################</span>
<span class='co'># Now run the same checks for functions of Calibration Estimators #</span>
<span class='co'>###################################################################</span>

<span class='co'># Build a population totals template and fill it with actual known totals computed from</span>
<span class='co'># the sampling frame (sbs.frame):</span>
<span class='no'>pop</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='pop.template.html'>pop.template</a></span>(<span class='no'>sbsdes</span>, <span class='kw'>calmodel</span><span class='kw'>=</span> ~<span class='no'>ent</span>:<span class='no'>emp.cl</span> + <span class='no'>y</span>:<span class='no'>nace.macro</span>-<span class='fl'>1</span>, <span class='kw'>partition</span><span class='kw'>=</span> ~<span class='no'>region</span>)
<span class='no'>pop</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='fill.template.html'>fill.template</a></span>(<span class='no'>sbs.frame</span>, <span class='no'>pop</span>)</div><div class='output co'>#&gt; 
#&gt; # Coherence check between 'universe' and 'template': OK
#&gt; </div><div class='input'>
<span class='co'># Calibrate the weights:</span>
<span class='no'>sbscal</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='e.calibrate.html'>e.calibrate</a></span>(<span class='no'>sbsdes</span>, <span class='no'>pop</span>)
<span class='fu'><a href='g.range.html'>g.range</a></span>(<span class='no'>sbscal</span>)</div><div class='output co'>#&gt;     g.min     g.max 
#&gt; 0.3820877 1.1697223 </div><div class='input'>
<span class='co'>#############</span>
<span class='co'>## Check 3 ##</span>
<span class='co'>#############</span>
<span class='co'># Global estimate (i.e., no domains) of a nonlinear function of CAL estimators:</span>
<span class='co'># - Average value added per employee</span>

<span class='co'># Compute the linearized variable of the estimator (the name gez should remind you of</span>
<span class='co'># the g-weighted residuals of the HT linearized variable w.r.t. the calibration model):</span>
<span class='no'>gez</span> <span class='kw'>&lt;-</span> <span class='fu'>get.linvar</span>(<span class='no'>sbscal</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>))

<span class='co'># Have a look: </span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>gez</span>)</div><div class='output co'>#&gt;             gez
#&gt; 1  0.0002200544
#&gt; 2 -0.0025673217
#&gt; 3 -0.0027184816
#&gt; 4 -0.0027183470
#&gt; 5 -0.0033873263
#&gt; 6 -0.0033391179</div><div class='input'>
<span class='co'># Now add that variable to the initial *uncalibrated* design object:</span>
<span class='no'>sbsdes</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='des.addvars.html'>des.addvars</a></span>(<span class='no'>sbsdes</span>, <span class='kw'>gez</span> <span class='kw'>=</span> <span class='no'>gez</span>)

<span class='co'># Now compute the estimated standard error of the *HT total* of the linearized variable:</span>
<span class='fu'><a href='svystatTM.html'>svystatTM</a></span>(<span class='no'>sbsdes</span>, ~<span class='no'>gez</span>)</div><div class='output co'>#&gt;             Total        SE
#&gt; gez -4.937674e-15 0.8554308</div><div class='input'>
<span class='co'># And compare it to the estimated standard error of the complex *calibration* estimator:</span>
<span class='fu'><a href='svystatL.html'>svystatL</a></span>(<span class='no'>sbscal</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>))</div><div class='output co'>#&gt;                  Complex        SE
#&gt; va.imp2/emp.num 56.54261 0.8554308</div><div class='input'>
<span class='co'># ...which - in this case - can equivalently be obtained exploiting its ratio nature:</span>
<span class='fu'><a href='svystatR.html'>svystatR</a></span>(<span class='no'>sbscal</span>, <span class='kw'>num</span> <span class='kw'>=</span> ~<span class='no'>va.imp2</span>, <span class='kw'>den</span><span class='kw'>=</span> ~<span class='no'>emp.num</span>)</div><div class='output co'>#&gt;                    Ratio        SE
#&gt; va.imp2/emp.num 56.54261 0.8554308</div><div class='input'>
<span class='co'># Test the equality of the results:</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span>(<span class='fu'><a href='svystatTM.html'>svystatTM</a></span>(<span class='no'>sbsdes</span>, ~<span class='no'>gez</span>)$<span class='no'>SE</span>,
          <span class='fu'><a href='svystatL.html'>svystatL</a></span>(<span class='no'>sbscal</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>))$<span class='no'>SE</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='co'># OK</span>

<span class='co'>#############</span>
<span class='co'>## Check 4 ##</span>
<span class='co'>#############</span>
<span class='co'># Domain estimates of a nonlinear function of CAL estimators:</span>
<span class='co'># - Average value added per employee by NACE macro-sectors</span>

<span class='co'># Compute the linearized variable(s) of the domain estimator(s):</span>
<span class='no'>gez.dom</span> <span class='kw'>&lt;-</span> <span class='fu'>get.linvar</span>(<span class='no'>sbscal</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>), <span class='kw'>by</span> <span class='kw'>=</span> ~<span class='no'>nace.macro</span>)

<span class='co'># Have a look: </span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>gez.dom</span>)</div><div class='output co'>#&gt;      gez_Agriculture gez_Industry gez_Commerce  gez_Services
#&gt; [1,]      0.08832571 -0.001569001  0.003286128 -0.0009192289
#&gt; [2,]     -0.07952122 -0.001724095  0.003953348 -0.0005727482
#&gt; [3,]     -0.09158169 -0.001863556  0.004554392 -0.0002598170
#&gt; [4,]     -0.09263152 -0.001912281  0.004764609 -0.0001501959
#&gt; [5,]     -0.13106081 -0.001857972  0.004530306 -0.0002723712
#&gt; [6,]     -0.21674829  0.000218825  0.003100713  0.0003404993</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span>(<span class='no'>gez.dom</span>)</div><div class='output co'>#&gt;         gez_Agriculture  gez_Industry gez_Commerce  gez_Services
#&gt; [6904,]   -3.350826e-04  0.0003841800  0.017881716 -0.0068263119
#&gt; [6905,]   -4.642672e-05  0.0007062987  0.019760903 -0.0025790194
#&gt; [6906,]   -5.569347e-04 -0.0001049788  0.004258778 -0.0016469592
#&gt; [6907,]   -5.778319e-04 -0.0001282706  0.004124138 -0.0019071877
#&gt; [6908,]   -1.389237e-03 -0.0001650359  0.001535488 -0.0006649312
#&gt; [6909,]   -1.411036e-03 -0.0001894359  0.001394730 -0.0008227651</div><div class='input'>
<span class='co'># As you see the matrix no longer has the staggered structure of the HT case. In fact, the</span>
<span class='co'># calibration residuals are in general not 0 outside the active domain. Therefore, you</span>
<span class='co'># cannot opt for the more convenient stacked format!</span>

<span class='co'># Let's thus add all the column of the linearized variable(s) matrix to the initial</span>
<span class='co'># *uncalibrated* design object:</span>
<span class='no'>sbsdes</span>$<span class='no'>variables</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='no'>sbsdes</span>$<span class='no'>variables</span>, <span class='no'>gez.dom</span>)

<span class='co'># Now compute the estimated standard error of the *HT totals* of the *domain-specific*</span>
<span class='co'># linearized variables:</span>
<span class='fu'><a href='svystatTM.html'>svystatTM</a></span>(<span class='no'>sbsdes</span>, ~<span class='no'>gez_Agriculture</span> + <span class='no'>gez_Industry</span> + <span class='no'>gez_Commerce</span> + <span class='no'>gez_Services</span>)</div><div class='output co'>#&gt;                         Total         SE
#&gt; gez_Agriculture -1.053756e-13  2.6731348
#&gt; gez_Industry     4.727406e-15  0.7109626
#&gt; gez_Commerce     1.956698e-14 14.4259517
#&gt; gez_Services     3.743587e-15  0.6770744</div><div class='input'>
<span class='co'># And compare it to the estimated standard errors of the complex *calibration* estimator</span>
<span class='co'># by domains:</span>
<span class='fu'><a href='svystatL.html'>svystatL</a></span>(<span class='no'>sbscal</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>), <span class='kw'>by</span><span class='kw'>=</span> ~<span class='no'>nace.macro</span>)</div><div class='output co'>#&gt;              nace.macro va.imp2/emp.num SE.va.imp2/emp.num
#&gt; Agriculture Agriculture        57.14679          2.6731348
#&gt; Industry       Industry        48.17033          0.7109626
#&gt; Commerce       Commerce       227.37322         14.4259517
#&gt; Services       Services        36.80444          0.6770744</div><div class='input'>
<span class='co'># ...which - in this case - can equivalently be obtained exploiting its ratio nature:</span>
<span class='fu'><a href='svystatR.html'>svystatR</a></span>(<span class='no'>sbscal</span>, <span class='kw'>num</span> <span class='kw'>=</span> ~<span class='no'>va.imp2</span>, <span class='kw'>den</span><span class='kw'>=</span> ~<span class='no'>emp.num</span>, <span class='kw'>by</span><span class='kw'>=</span> ~<span class='no'>nace.macro</span>)</div><div class='output co'>#&gt;              nace.macro va.imp2/emp.num SE.va.imp2/emp.num
#&gt; Agriculture Agriculture        57.14679          2.6731348
#&gt; Industry       Industry        48.17033          0.7109626
#&gt; Commerce       Commerce       227.37322         14.4259517
#&gt; Services       Services        36.80444          0.6770744</div><div class='input'>
<span class='co'># Test the equality of the results:</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span>(
  <span class='fu'><a href='svystatTM.html'>svystatTM</a></span>(<span class='no'>sbsdes</span>, ~<span class='no'>gez_Agriculture</span> + <span class='no'>gez_Industry</span> + <span class='no'>gez_Commerce</span> + <span class='no'>gez_Services</span>)$<span class='no'>SE</span>,
  <span class='fu'><a href='svystatL.html'>svystatL</a></span>(<span class='no'>sbscal</span>, <span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span>(<span class='no'>va.imp2</span>/<span class='no'>emp.num</span>), <span class='kw'>by</span><span class='kw'>=</span> ~<span class='no'>nace.macro</span>)$<span class='no'>SE</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'># OK

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Diego Zardetto</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Diego Zardetto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


